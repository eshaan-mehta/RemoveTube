document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("status"),t=document.getElementById("toggleBtn"),n=document.getElementById("settingsBtn"),o=document.getElementById("topicsList"),s=document.getElementById("blockedCount"),a=document.getElementById("allowedCount");function l(){chrome.storage.sync.get(["allowedTopics","isSetupComplete","extensionEnabled","dailyStats"],(async n=>{const l=n.allowedTopics||[],c=n.isSetupComplete||!1,i=!1!==n.extensionEnabled,d=n.dailyStats||{blocked:0,allowed:0,date:(new Date).toDateString()};let r="Unknown";try{const e=await fetch("https://removetube-server.onrender.com/health");r=e.ok?"healthy"===(await e.json()).status?"✅ Online":"⚠️ Issues":"❌ Offline"}catch(e){r="❌ Offline"}c?i?0===l.length?(e.textContent="⚠️ No Topics Set",e.className="status inactive",t.textContent="Setup"):(e.textContent=`✅ Active & Protecting (Server: ${r})`,e.className="status active",t.textContent="Disable"):(e.textContent="⏸️ Paused",e.className="status inactive",t.textContent="Enable"):(e.textContent="⚙️ Setup Required",e.className="status inactive",t.textContent="Setup"),l.length>0?o.textContent=l.join(", "):o.textContent="No topics set";const m=(new Date).toDateString();d.date!==m&&(d.blocked=0,d.allowed=0,d.date=m,chrome.storage.sync.set({dailyStats:d})),s.textContent=d.blocked,a.textContent=d.allowed}))}t.addEventListener("click",(()=>{chrome.storage.sync.get(["isSetupComplete","extensionEnabled"],(e=>{if(e.isSetupComplete){const t=!e.extensionEnabled;chrome.storage.sync.set({extensionEnabled:t},(()=>{l()}))}else chrome.runtime.openOptionsPage()}))})),n.addEventListener("click",(()=>{chrome.runtime.openOptionsPage()})),l();const c=setInterval(l,3e3);window.addEventListener("beforeunload",(()=>{clearInterval(c)}))}));